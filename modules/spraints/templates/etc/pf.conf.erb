zig_if  = <%= @zig_if %>
att_if  = <%= @att_if %>
int_if  = <%= @int_if %>
int_net = <%= @int_if %>:network
ext_ifs = "{" $zig_if $att_if "}"

turbo_ports = "{ ssh, domain }"

set block-policy drop
set skip on lo0

# This table will be manipulated at runtime
table <turbo_hosts> counters

# This table will also be manipulated at runtime, but maybe not as much.
# stuff like dominion, screenhero, bluejeans?
table <turbo_sites> counters

match in all scrub (no-df random-id max-mss 1440)

# Default all traffic to zig
match out on $zig_if from $int_net to any nat-to $zig_if

# <turbo_hosts> is an opt-in list of hosts that want a burst of SPEED
match out on $att_if from <turbo_hosts> to any nat-to $att_if
# <turbo_sites> is a list of sites that should always be FAST
match out on $att_if from any to <turbo_sites> nat-to $att_if
# Send all ssh sessions over AT&T. They should be low bandwidth, and it'd be nice if they're fast.
match out on $att_if inet from any to any port $turbo_ports nat-to $att_if

# Default to everything OK, except incoming traffic from the OUTSIDE
pass all
block in on $ext_ifs
# Let me ssh from the external networks. This might be useful some day?
pass in on $ext_ifs from any to any port ssh
# Everything outgoing is OK.
pass out inet
pass out on $ext_ifs proto tcp modulate state
pass out on $ext_ifs proto udp     keep state
